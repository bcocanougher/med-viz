<!DOCTYPE html>
<html>
  	<head>
    	<title>reading file</title>
    	<script type="text/javascript">
    		
    		var bodyShapes;
            var muscleShapes;

            var nMuscles = 6;
            var nColors = 2;

            var colors = new Array(nMuscles);
            for (var i=0; i<nMuscles; i++) {
                colors[i] = 0;
            }

            var init = function() {
                // generate buttons
                makeButtons();

                // read json file with art information
                loadAndDraw("body.json", bodyShapes);
                loadAndDraw("muscles.json", muscleShapes);
                
                // testing
                document.getElementById("test-text").innerHTML = colors;
            }

            var updateColors = function(that) {
                muscle = parseInt(that.id.substring(6, that.id.length));
                colors[muscle] = that.value;
                
                // testing
                document.getElementById("test-text").innerHTML = colors;
            }

            var makeButtons = function() {
                var buttonString = '';
                buttonString += '<ul>\n';
                for (var i=0; i<nMuscles; i++) {
                    buttonString += '<li>\n';
                    buttonString += '<select id=muscle' + i + ' onchange="updateColors(this)">\n';
                    buttonString += '<option value="0"></option>\n';
                    for (var j=0; j<nColors; j++) {
                        option = j+1;
                        buttonString += '<option value="' + option + '">color' + option + '</option>\n';
                    }
                    buttonString += '</li>\n';
                    buttonString += '</select>\n';
                }
                buttonString += '</ul>\n';

                document.getElementById('buttons').innerHTML = buttonString;
                console.log(buttonString);
            }

            var loadAndDraw = function(url, shapes) {
                var xmlhttp = new XMLHttpRequest();

                xmlhttp.onreadystatechange = function() {
                    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                        shapes = JSON.parse(xmlhttp.responseText);
                        drawShapes(shapes);
                    }
                }

                xmlhttp.open("GET", url, true);
                xmlhttp.send();
            }

            var drawShapes = function(arr) {

                for (var i=0; i<arr.length; i++) {
                    drawShape(arr[i]);
                }
            }

            var drawShape = function(data) {

                // set up canvas
    			var canvas = document.getElementById("canvas");
				var ctx = canvas.getContext("2d");

				// // line/fill properties
				ctx.fillStyle="rgb(255,255,255)";
				ctx.lineStyle="rgb(0,0,0)";
				ctx.lineWidth=2;

    			// draw line elements
    			dx = -375;
                dy = 575;
    			for (var i=0; i<data.length; i++) {
    				d = data[i];
    				if (d.line) {
    					v = d.line;
    					ctx.moveTo(dx+v[0], dy+v[1]);
    					ctx.lineTo(dx+v[2], dy+v[3]);
    				}
    				else if (d.bezier) {
    					v = d.bezier;
    					ctx.moveTo(dx+v[0], dy+v[1]);
    					ctx.bezierCurveTo(dx+v[2], dy+v[3], dx+v[4], dy+v[5], dx+v[6], dy+v[7]);
    				}
    			}
    			ctx.stroke();
    			ctx.fill();
    		}

		</script>
	</head>

	<body onload='init()'>
        <div class="container">
            <div id="buttons" style="float:left;">
               <!-- buttons generated by makeButtons() on load -->
            </div>
            <div style="float:center;">
                <canvas id="canvas" width="225" height="600"></canvas>
            </div>
            <div id="test-text" style="float:right;">
                example text
            </div>
        </div>
	</body>
</html>